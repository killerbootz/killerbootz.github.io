---
layout: post
title: GeminiV2 Walkthrough
published: true
---
This is a walkthrough of the CTF machine "Gemini2" on [Vulnhub](https://www.vulnhub.com/entry/gemini-inc-2,234/). A tough VM, with lots of learning potential!


 
      ****Spoiler Alert****          ****Spoiler Alert****



I seem to always be doing these CTFs in reverse order. I'll be going back to do GeminiV1 after this, but for me this was very challenging and fun. I learned from both a web application and privilege escalation perspective as this one seemed to be very real-world based. So let's get going!


![GeminiV2 NmapOutput]({{ site.url }}/images/GeminiV2/nmap.JPG)

The Nmap output looks to be limited to only SSH and HTTP, so let's see what the webpage is serving up.

![GeminiV2 BasePage]({{ site.url }}/images/GeminiV2/base_page.JPG)

Ok, so we have a page with uses that are apparently locked to an authenticated session (i.e. export of the profile, accessing the user list etc.). What about Nikto?

![GeminiV2 Nikto]({{ site.url }}/images/GeminiV2/nikto.JPG)

Wah-wah. Not really that useful. I was getting similar results using dirb, and using a longer wordlist was taking too long, so I switched to dirbuster (GUI) and found some interesting files:

![GeminiV2 Register]({{ site.url }}/images/GeminiV2/register.JPG)  

I'm not really seeing any other angles of attack at the moment, so let's head on over to regisration.php and see if we can register a user:

![GeminiV2 Registration]({{ site.url }}/images/GeminiV2/registration.JPG) 

The registration process here is simple until we're hit with:

![GeminiV2 Register_Noactivate]({{ site.url }}/images/GeminiV2/register_noactivate.JPG)

I only had to guess the activation site (activate.php), but upon landing, along with the activation code, it is asking for the user "id". Luckily, I had already noticed this in the URL after registering as it gives a __profile.php?u=16__ You can use this to map other user IDs as well, but for this instance we only needed to know ours so we can activate our account.

What's great is that at least we're given the type and length of code we're expected to have ("6 digit").  
So first off I wanted to create a database of every possible 6 digit code combination. Crunch is a great tool for that, and didn't take more than a couple of seconds to run and create:

![GeminiV2 Activate_Dic]({{ site.url }}/images/GeminiV2/crunch.JPG)

Next, I need to find a way to "feed" these one at a time to the activation form. Let's look at the activation request in Burp Suite to see what we're dealing with:

![GeminiV2 Activate_Req]({{ site.url }}/images/GeminiV2/activate_request.JPG)

So, it looks like we're going to have a CSRF token to contend with here. With an incorrect activation code, we recieve a "403 INVALID VALUE" response from the server (as seen below):

![GeminiV2 Activate_Res]({{ site.url }}/images/GeminiV2/activate_response.JPG)

To get started I exported the original POST request I had in Burp, as a Curl command. From that point I was a bit stumped and truely was not sure how to bypass the CSRF token. I ended up watching a bit of the walkthough from the creator of this [CTF](https://scriptkidd1e.wordpress.com/geminiinc-v2-virtual-machine-walkthrough/) I was pleased to see him perform the exact same Curl export that I was stumped on, so when I saw him grep the token, I knew that was what I was missing, stopped the walkthough and finished the script I had began:

![GeminiV2 CSRF_Bypass]({{ site.url }}/images/GeminiV2/CSRF_Bypass_activate.JPG)  

Is this script ugly. Oh yeah. Does it work? You bet. I echo'd the token and code just to ensure both were random for each request. Running the request through Burp made searching for the correct code extremely easy, as I was looking for the only non-403 value present:

![GeminiV2 Activation_Code]({{ site.url }}/images/GeminiV2/activation_code.JPG)  

As you can see, the only non-403 code was a 302, using activation_code 000511. 

